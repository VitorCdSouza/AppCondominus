_id,client_secret:this.settings.ims_client_secret},e.ajax({url:this.settings.ims_host+"ims/token/v1",type:"POST",data:i,contentType:"application/x-www-form-urlencoded; charset=UTF-8"}).then(this.proxy((function(t){var i=(new Date).getTime();this.settings.auth_token="Bearer "+t.access_token,this.settings.refresh_token=t.refresh_token,this.settings.token_expiry=i+t.expires_in,this.settings.refresh_time=i+t.expires_in/2,r.resolve(),e.consoleLog("refresh token result"),e.consoleLogDir(t)})),this.proxy((function(){this.noToken(r)})))):r.reject(),r.promise()}ajaxReady(t){let i=e.Deferred();return this.settings.auth_token?this.refreshToken(t).then(this.proxy((function(){i.resolve()})),this.proxy((function(){this.noToken(i)}))):this.connect().then(this.proxy((function(){this.settings.files_root?i.resolve():e.ajax({url:this.settings.files_api+"root",type:"GET",headers:this.GET_headers()}).then(this.proxy((function(e){i.resolve(),this.settings.files_root=e.id})),this.proxy((function(){this.noToken(i)})))})),this.proxy((function(){this.noToken(i)})